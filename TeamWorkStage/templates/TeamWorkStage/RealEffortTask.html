{{ extends "global/CSS_Page.html" }}
{{ load otree }}

{{ block title }}... Please encode following string in digit code ... {{ endblock }}

{{ block content }}

<div id="imagePlaceholder"> <img src="{% static "KodierungsTabelle.jpg" %}" alt="Table not found"></div>
<div id="timer">{{dauerDesThreatmentsInSekunden}} Sekunden</div>
<div id="score">Correct answers: 0</div>
<div type="text" id="display" style="margin-top: 40px; font-size: 2em;text-align: center;align-items: center; display: flex;justify-content: center;">Anzeigefeld</div>
<div>
    <input type="text" id="inputField"  placeholder="Gib die passende Zahl ein" oninput="resetInputStyle()" onkeydown="if (event.key === 'Enter') compareNumbers()">
</div>
<button id="compareButton" onclick="compareNumbers()">Compare</button>
<div id="feedback"></div>

<script>
    // BUTTON soll nicht weiter schicken, sondern nur die Funktion ausf체hren
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('compareButton').addEventListener('click',
                function(event) {
                    event.preventDefault();
                    // nur einmal absenden, daher hier ausgeklammert
                    //!! compareNumbers();
            });
        });




        const encoding = {
            'A': '123',
            'B': '234',
            'C': '456',
            // Weitere Kodierungen hier hinzuf체gen
        };



        function getRandomChar() {
            const chars = Object.keys(encoding);
            return chars[Math.floor(Math.random() * chars.length)];
        }

        function getRandomString(length) {
            let result = '';
            for (let i = 0; i < length; i++) {
                result += getRandomChar();
            }
            return result;
        }

        function getEncodedString(str) {
            return str.split('').map(char => encoding[char]).join('');
        }

        function compareNumbers() {
            const input = document.getElementById('inputField').value;
            const encodedString = getEncodedString(randomString);
            const feedbackElement = document.getElementById('feedback');
//alert("encodedString: "+encodedString+" input: "+input);
            if (input === encodedString) {
                correctAnswers++;
                feedbackElement.innerText = "Correct!";
                feedbackElement.style.color = "green";
                document.getElementById('inputField').style.borderColor = "green";
            } else {
                feedbackElement.innerText = "Wrong!";
                feedbackElement.style.color = "red";
                document.getElementById('inputField').style.borderColor = "red";
            }

            setTimeout(() => {
                feedbackElement.innerText = "";
            }, 1000);
liveSend(correctAnswers);
            document.getElementById('score').innerText = `Correct answers: ${correctAnswers}`;



            randomString = getRandomString(5);
            document.getElementById('display').innerText = randomString;
            document.getElementById('inputField').value = '';
            document.getElementById('inputField').focus();
        }

        function resetInputStyle() {
            document.getElementById('inputField').style.borderColor = "#00f";
        }

        let correctAnswers = 0;
        let randomString = getRandomString(5);  // Initialisierung der zuf채lligen Zeichenkette
        document.getElementById('display').innerText = randomString;  // Anzeige der zuf채lligen Zeichenkette
        let timeLeft = {{Constants.dauerDesThreatmentsInSekunden}};
        const timerElement = document.getElementById('timer');

        function countdown() {
            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                showNextPage();
            } else {
                timerElement.innerText = timeLeft + " Sekunden";
                if (timeLeft <= 5) {
                    timerElement.style.color = "red";
                    timerElement.classList.add("blink");
                } else if (timeLeft <= 10) {
                    timerElement.style.color = "red";
                    timerElement.classList.remove("blink");
                } else {
                    timerElement.style.color = "green";
                    timerElement.classList.remove("blink");
                }
                timeLeft--;
            }
        }

        function showNextPage() {
          liveSend({type: 'next'});
        }

        const timerInterval = setInterval(countdown, 1000);
        window.onload = function() {
            document.getElementById('inputField').focus();
        }
    </script>


{{ endblock }}
